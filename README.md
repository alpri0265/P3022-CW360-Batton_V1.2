# P3022-V1-CW360 Angle Sensor with LCD Display

Arduino скетч для роботи з датчиком кута P3022-V1-CW360, LCD дисплеєм та енкодером EC-11.

## Підтримувані плати

- ✅ **Arduino Uno** (ATmega328P, 16MHz, 5V)
- ✅ **Arduino Nano** (ATmega328P, 16MHz, 5V)
- ✅ **Arduino Micro** (ATmega32U4, 16MHz, 5V)

## Підтримувані LCD

- ✅ **LCD 1602** (16x2 символи) - I2C або 4-bit паралельний
- ✅ **LCD 2004** (20x4 символи) - I2C або 4-bit паралельний

## 📚 Документація

- **[Інструкція по роботі з меню](MENU_GUIDE.md)** - Детальна інструкція з використання меню системи
- **[Детальна розпіновка](#детальна-розпіновка)** - Підключення для різних Arduino плат

## Встановлення

### Бібліотеки

Для I2C LCD (за замовчуванням):
- **LiquidCrystal_I2C** (by Frank de Brabander)
  - Arduino IDE: Sketch → Include Library → Manage Libraries → "LiquidCrystal I2C"
  
Для 4-bit LCD (опціонально):
- **LiquidCrystal** (вбудована бібліотека Arduino)

### Налаштування

1. Відкрийте файл `Config.h`
2. Виберіть тип LCD:
   ```cpp
   #define LCD_TYPE_1602      // або
   // #define LCD_TYPE_2004
   ```
3. Виберіть інтерфейс LCD:
   ```cpp
   #define LCD_INTERFACE_I2C      // або
   // #define LCD_INTERFACE_PARALLEL_4BIT
   ```
4. Для I2C - налаштуйте адресу (якщо потрібно):
   ```cpp
   #define LCD_I2C_ADDR 0x27  // або 0x3F
   ```

---

## Детальна розпіновка

### Загальна розпіновка (однакова для всіх плат)

| Компонент | Пін Arduino | Примітка |
|-----------|-------------|----------|
| **EC-11 Encoder** |
| Channel A | D2 | З pullup (INPUT_PULLUP) |
| Channel B | D3 | З pullup (INPUT_PULLUP) |
| Switch (SW) | D4 | Кнопка на GND, з pullup |
| **P3022 Sensor** |
| OUT | A0 | Аналоговий вихід (0-5V) |
| VCC | 5V | Живлення |
| GND | GND | Земля |

---

## Розпіновка для Arduino Uno

### Arduino Uno (ATmega328P)

**Фізичні піни Uno:**
- Цифрові: D0-D13, A0-A5 (A0-A5 також доступні як цифрові піни D14-D19)
- Аналогові: A0-A5 (10-bit ADC, 0-1023)
- I2C: SDA=A4, SCL=A5
- Питаня: 5V, 3.3V, GND, VIN

### Підключення для Uno

#### LCD через I2C (рекомендовано)

```
LCD I2C Module (PCF8574)    Arduino Uno
─────────────────────────   ───────────
VCC                        → 5V
GND                        → GND
SDA                        → A4 (SDA)
SCL                        → A5 (SCL)
```

**Примітка:** I2C адреса зазвичай 0x27 або 0x3F (налаштуйте в Config.h)

#### LCD через 4-bit паралельний

```
LCD 1602/2004              Arduino Uno
─────────────────────────   ───────────
VSS (GND)                  → GND
VDD (VCC)                  → 5V
V0                         → Потенціометр (контраст) → GND
RS (Register Select)       → D12
RW (Read/Write)            → GND (завжди на запис)
E (Enable)                 → D11
D4 (Data 4)                → D7
D5 (Data 5)                → D6
D6 (Data 6)                → D5
D7 (Data 7)                → D8
A (Anode LED backlight)    → 5V через резистор 220Ω
K (Cathode LED backlight)  → GND
```

**Таблиця підключення LCD (4-bit):**
| LCD Pin | Arduino Uno | Опис |
|---------|-------------|------|
| VSS | GND | Земля |
| VDD | 5V | Живлення |
| V0 | Потенціометр | Контраст |
| RS | D12 | Реєстр вибору |
| RW | GND | Читання/запис (завжди GND) |
| E | D11 | Enable |
| D4 | D7 | Дані біт 4 |
| D5 | D6 | Дані біт 5 |
| D6 | D5 | Дані біт 6 |
| D7 | D8 | Дані біт 7 |
| A | 5V через 220Ω | Підсвітка анод |
| K | GND | Підсвітка катод |

---

## Розпіновка для Arduino Nano

### Arduino Nano (ATmega328P)

**Фізичні піни Nano:**
- Цифрові: D0-D13, A0-A7 (A0-A7 також доступні як цифрові D14-D21)
- Аналогові: A0-A7 (10-bit ADC, 0-1023)
- I2C: SDA=A4, SCL=A5
- Питаня: 5V, 3.3V, GND, VIN

### Підключення для Nano

#### LCD через I2C (рекомендовано)

```
LCD I2C Module (PCF8574)    Arduino Nano
─────────────────────────   ───────────
VCC                        → 5V
GND                        → GND
SDA                        → A4 (SDA)
SCL                        → A5 (SCL)
```

#### LCD через 4-bit паралельний

```
LCD 1602/2004              Arduino Nano
─────────────────────────   ───────────
VSS                        → GND
VDD                        → 5V
V0                         → Потенціометр → GND
RS                         → D12
RW                         → GND
E                          → D11
D4                         → D7
D5                         → D6
D6                         → D5
D7                         → D8
A (LED+)                   → 5V через 220Ω
K (LED-)                   → GND
```

**Важливо для Nano:**
- Nano має такі самі піни I2C як Uno: A4 (SDA), A5 (SCL)
- Усі інші піни ідентичні Uno
- Може працювати як від USB, так і від зовнішнього джерела живлення

---

## Розпіновка для Arduino Micro

### Arduino Micro (ATmega32U4)

**Фізичні піни Micro:**
- Цифрові: D0-D13, D18-D23 (A0-A5 доступні як цифрові D18-D23)
- Аналогові: A0-A5, A6-A11 (10-bit ADC, 0-1023)
- I2C: **SDA=D2, SCL=D3** ⚠️ (відрізняється від Uno/Nano!)
- Питаня: 5V, 3.3V, GND, VIN

**⚠️ ВАЖЛИВО для Micro:**
- I2C піни на Micro інші: **D2 (SDA), D3 (SCL)** замість A4/A5
- Бібліотека Wire автоматично використовує правильні піни
- **Конфлікт з енкодером!** Енкодер використовує D2 та D3

### Підключення для Micro

#### ⚠️ Проблема з I2C для Micro

**Для Micro I2C піни (D2, D3) зайняті енкодером!**

**Рішення 1: Використати 4-bit LCD (рекомендовано для Micro)**
```
LCD 1602/2004 (4-bit)      Arduino Micro
─────────────────────────   ───────────
VSS                        → GND
VDD                        → 5V
V0                         → Потенціометр → GND
RS                         → D12
RW                         → GND
E                          → D11
D4                         → D7
D5                         → D6
D6                         → D5
D7                         → D8
A (LED+)                   → 5V через 220Ω
K (LED-)                   → GND
```

**Рішення 2: Використати програмний I2C на інших пінах**
- Потрібно модифікувати код для використання програмного I2C
- Або використати I2C на пінах A4/A5 через апаратний TWI (може бути складніше)

#### Альтернативна розпіновка для Micro (якщо потрібен I2C)

Можна змінити піни енкодера:
- В `Config.h` змініть:
  ```cpp
  static const uint8_t PIN_ENC_A  = 5;   // Замість D2
  static const uint8_t PIN_ENC_B  = 6;   // Замість D3
  static const uint8_t PIN_ENC_SW = 7;   // Замість D4
  ```
- Тоді I2C на D2/D3 буде доступний

---

## Повна схема підключення

### Варіант 1: I2C LCD (Uno/Nano)

```
                    Arduino Uno/Nano
                    ┌──────────────┐
                    │              │
P3022 Sensor        │              │  EC-11 Encoder
  VCC ────────────→ │ 5V           │  VCC ────────────→ 5V
  OUT ────────────→ │ A0           │  A   ────────────→ D2
  GND ────────────→ │ GND          │  B   ────────────→ D3
                    │              │  SW  ────────────→ D4
                    │              │  GND ────────────→ GND
                    │              │
LCD I2C Module      │              │
  VCC ────────────→ │ 5V           │
  GND ────────────→ │ GND          │
  SDA ────────────→ │ A4 (SDA)     │
  SCL ────────────→ │ A5 (SCL)     │
                    │              │
                    └──────────────┘
```

### Варіант 2: 4-bit LCD (Uno/Nano/Micro)

```
                    Arduino (Uno/Nano/Micro)
                    ┌──────────────────────┐
                    │                      │
P3022 Sensor        │                      │  EC-11 Encoder
  VCC ────────────→ │ 5V                   │  VCC ────────────→ 5V
  OUT ────────────→ │ A0                   │  A   ────────────→ D2
  GND ────────────→ │ GND                  │  B   ────────────→ D3
                    │                      │  SW  ────────────→ D4
                    │                      │  GND ────────────→ GND
                    │                      │
LCD 1602/2004       │                      │
  VSS ────────────→ │ GND                  │
  VDD ────────────→ │ 5V                   │
  V0  ────────────→ │ Потенціометр         │
  RS  ────────────→ │ D12                  │
  RW  ────────────→ │ GND                  │
  E   ────────────→ │ D11                  │
  D4  ────────────→ │ D7                   │
  D5  ────────────→ │ D6                   │
  D6  ────────────→ │ D5                   │
  D7  ────────────→ │ D8                   │
  A   ────────────→ │ 5V (через 220Ω)      │
  K   ────────────→ │ GND                  │
                    │                      │
                    └──────────────────────┘
```

---

## Порівняльна таблиця пінів

| Компонент | Uno | Nano | Micro | Примітка |
|-----------|-----|------|-------|----------|
| **I2C SDA** | A4 | A4 | **D2** ⚠️ | Micro відрізняється! |
| **I2C SCL** | A5 | A5 | **D3** ⚠️ | Micro відрізняється! |
| **Encoder A** | D2 | D2 | D2 | Однакові |
| **Encoder B** | D3 | D3 | D3 | Однакові |
| **Encoder SW** | D4 | D4 | D4 | Однакові |
| **Sensor OUT** | A0 | A0 | A0 | Однакові |
| **LCD RS (4-bit)** | D12 | D12 | D12 | Однакові |
| **LCD E (4-bit)** | D11 | D11 | D11 | Однакові |
| **LCD D4-D7** | D7,6,5,8 | D7,6,5,8 | D7,6,5,8 | Однакові |

**⚠️ Конфлікт для Micro з I2C:**
- Micro: I2C на D2/D3, але енкодер також на D2/D3
- **Рішення:** Використати 4-bit LCD для Micro або змінити піни енкодера

---

## Детальна інструкція з підключення

### Крок 1: Підключення P3022 Sensor

1. Підключіть **VCC** датчика до **5V** Arduino
2. Підключіть **GND** датчика до **GND** Arduino
3. Підключіть **OUT** датчика до **A0** Arduino

**Примітка:** Датчик працює на 5V. Якщо використовуєте 3.3V плату, перевірте документацію датчика.

### Крок 2: Підключення EC-11 Encoder

EC-11 має 5 виводів:
- **VCC** - живлення (зазвичай не підключається, енкодер пасивний)
- **GND** - земля
- **A** - канал A (квадрaturний вихід)
- **B** - канал B (квадрaturний вихід)
- **SW** - кнопка (switch)

**Підключення:**
1. **A** → **D2** Arduino (з внутрішнім pullup)
2. **B** → **D3** Arduino (з внутрішнім pullup)
3. **SW** → **D4** Arduino (кнопка на GND, з внутрішнім pullup)
4. **GND** → **GND** Arduino

**Важливо:**
- Не потрібні зовнішні резистори pullup (використовуються внутрішні INPUT_PULLUP)
- Кнопка підключається між D4 та GND
- Якщо енкодер має власне живлення VCC, підключіть до 5V

### Крок 3: Підключення LCD (I2C)

#### I2C модуль (PCF8574) - рекомендовано для Uno/Nano

**Модуль PCF8574 зазвичай має 4 виводи:**
- **VCC** → **5V** Arduino
- **GND** → **GND** Arduino
- **SDA** → **A4** (Uno/Nano) або **D2** (Micro)
- **SCL** → **A5** (Uno/Nano) або **D3** (Micro)

**Кроки:**
1. Підключіть живлення (VCC/GND)
2. Підключіть I2C лінії (SDA/SCL)
3. Перевірте I2C адресу (зазвичай 0x27 або 0x3F)
4. Налаштуйте `LCD_I2C_ADDR` в `Config.h` якщо потрібно

**Визначення I2C адреси:**
- Використайте I2C Scanner скетч з прикладів Arduino
- Або перевірте перемикачі на модулі (якщо є)
- Типові адреси: 0x27, 0x3F

### Крок 4: Підключення LCD (4-bit паралельний)

**Піни LCD 1602/2004:**

| Номер | Назва | Опис | Підключення |
|-------|-------|------|-------------|
| 1 | VSS | Земля | GND |
| 2 | VDD | Живлення | 5V |
| 3 | V0 | Контраст | Потенціометр (10kΩ) між 5V та GND, середній вивід на V0 |
| 4 | RS | Реєстр вибору | D12 |
| 5 | RW | Читання/Запис | GND (завжди на запис) |
| 6 | E | Enable | D11 |
| 7 | D0 | Дані біт 0 | Не підключається (4-bit режим) |
| 8 | D1 | Дані біт 1 | Не підключається (4-bit режим) |
| 9 | D2 | Дані біт 2 | Не підключається (4-bit режим) |
| 10 | D3 | Дані біт 3 | Не підключається (4-bit режим) |
| 11 | D4 | Дані біт 4 | D7 |
| 12 | D5 | Дані біт 5 | D6 |
| 13 | D6 | Дані біт 6 | D5 |
| 14 | D7 | Дані біт 7 | D8 |
| 15 | A | Підсвітка анод | 5V через резистор 220Ω |
| 16 | K | Підсвітка катод | GND |

**Схема підключення V0 (контраст):**
```
5V ──[10kΩ]── V0 ──[10kΩ]── GND
              (середній вивід
              потенціометра)
```

**Налаштування контрасту:**
- Обертайте потенціометр до отримання чіткого зображення
- Занадто темно → поверніть в бік 5V
- Занадто світло/забілення → поверніть в бік GND

---

## Рекомендовані конфігурації

### Для Arduino Uno
✅ **I2C LCD 1602 або 2004** - найпростіше підключення, менше проводів

### Для Arduino Nano
✅ **I2C LCD 1602 або 2004** - найпростіше підключення
- Nano компактніша, тому I2C економить місце

### Для Arduino Micro
⚠️ **4-bit LCD** - рекомендовано (конфлікт I2C пінів)
- Або змінити піни енкодера для використання I2C

---

## Перевірка підключення

### Тест пінів

1. **Енкодер:**
   - Обертайте валик → значення на дисплеї повинно змінюватися
   - Натисніть кнопку → відкриється меню

2. **P3022 Sensor:**
   - Обертайте датчик → кут на дисплеї повинен змінюватися
   - Значення ADC можна перевірити в меню "View"

3. **LCD Display:**
   - При включенні повинен з'явитися текст "P3022 Sensor"
   - Якщо нічого не видно → перевірте контраст (V0)
   - Якщо занадто темно → перевірте підсвітку (піни A/K)

### Типові проблеми

**LCD не відображає:**
- ❌ Неправильна I2C адреса → змініть `LCD_I2C_ADDR` в Config.h
- ❌ Невірне підключення SDA/SCL → перевірте підключення
- ❌ Проблема з контрастом (4-bit) → налаштуйте потенціометр V0
- ❌ Відсутня підсвітка → перевірте піни A/K та резистор

**Енкодер не працює:**
- ❌ Неправильне підключення A/B → перевірте D2/D3
- ❌ Кнопка не працює → перевірте D4 та підключення до GND
- ❌ Підключіть GND енкодера до GND Arduino

**Датчик показує некоректні значення:**
- ❌ Неправильне підключення OUT → перевірте A0
- ❌ Потрібна калібрування → використайте меню "Cal Min/Max"
- ❌ Перевірте живлення (VCC=5V, GND)

---

## Корисні посилання

- [Arduino Uno Pinout](https://www.arduino.cc/en/uploads/Main/Arduino_Uno_Rev3-schematic.pdf)
- [Arduino Nano Pinout](https://www.arduino.cc/en/uploads/Main/ArduinoNano30Schematic.pdf)
- [Arduino Micro Pinout](https://www.arduino.cc/en/uploads/Main/arduino-micro-schematic.pdf)
- [EC-11 Encoder Datasheet](https://www.bourns.com/docs/Product-Datasheets/EC11.pdf)
- [HD44780 LCD Controller](https://www.sparkfun.com/datasheets/LCD/HD44780.pdf)

---

## Структура проекту

```
P3022-V1-CW360/
├── P3022-V1-CW360.ino    # Основний файл
├── Config.h               # Конфігурація (вибір LCD, піни)
├── Encoder.h / .cpp       # Клас обробки енкодера
├── LCDDisplay.h / .cpp    # Клас управління LCD
├── MenuManager.h / .cpp   # Клас меню та UI
├── Settings.h / .cpp      # Налаштування EEPROM
├── Sensor.h / .cpp        # Обробка датчика P3022
├── Utils.h / .cpp         # Допоміжні функції
└── README.md              # Ця інструкція
```

---

## Підтримка

Якщо виникли проблеми з підключенням:
1. Перевірте всі з'єднання за схемами вище
2. Переконайтеся, що вибрана правильна плата в Arduino IDE
3. Перевірте правильність налаштувань в `Config.h`
4. Використайте I2C Scanner для перевірки адреси LCD

---

**Версія:** 1.0  
**Дата:** 2024  
**Автор:** P3022-V1-CW360 Project
